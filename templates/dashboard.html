<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ—è—Ç –ì—Ä–∞—Ñ–∏–∫</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .date-nav { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .card { border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 8px; background: #f9f9f9; }
        .time { font-weight: bold; font-size: 1.2em; color: #333; }
        .status-confirmed { color: green; }
        .status-cancelled { color: red; text-decoration: line-through; }
        button { padding: 10px; cursor: pointer; }
    </style>
</head>
<body>

    <h1>üìÖ –ú–æ—è—Ç –ì—Ä–∞—Ñ–∏–∫</h1>

    <div class="date-nav">
        <input type="date" id="datePicker">
        <button onclick="loadSchedule()">–ó–∞—Ä–µ–¥–∏</button>
    </div>

    <div id="schedule-container">
        Loading...
    </div>

    <script>
        // 1. –°–ª–∞–≥–∞–º–µ –¥–Ω–µ—à–Ω–∞ –¥–∞—Ç–∞ –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ
        const dateInput = document.getElementById('datePicker');
        dateInput.value = new Date().toISOString().split('T')[0];

        async function loadSchedule() {
            const date = dateInput.value;
            const container = document.getElementById('schedule-container');
            container.innerHTML = '–ó–∞—Ä–µ–∂–¥–∞–Ω–µ...';

            try {
                // –ò–∑–≤–∏–∫–≤–∞–º–µ –Ω–∞—à–µ—Ç–æ –Ω–æ–≤–æ API
                // –¢—ä–π –∫–∞—Ç–æ —Å–º–µ –ª–æ–≥–Ω–∞—Ç–∏ –≤ –±—Ä–∞—É–∑—ä—Ä–∞ (session auth), Django –∑–Ω–∞–µ –∫–æ–∏ —Å–º–µ
                const response = await fetch(`/api/my-schedule/?date=${date}`);

                if (response.status === 403) {
                    container.innerHTML = '<p style="color:red">–ù–µ —Å—Ç–µ –≤–ª–µ–∑–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–∞—Ç–∞! –ú–æ–ª—è, –≤–ª–µ–∑—Ç–µ –ø—Ä–µ–∑ /admin</p>';
                    return;
                }

                const appointments = await response.json();

                if (appointments.length === 0) {
                    container.innerHTML = '<p>–ù—è–º–∞ –∑–∞–ø–∏—Å–∞–Ω–∏ —á–∞—Å–æ–≤–µ –∑–∞ —Ç–∞–∑–∏ –¥–∞—Ç–∞. ‚òï –ü–æ—á–∏–≤–∫–∞!</p>';
                    return;
                }

                let html = '';
                appointments.forEach(app => {
                    const statusClass = app.status === 'cancelled' ? 'status-cancelled' : 'status-confirmed';

                    html += `
                        <div class="card ${statusClass}">
                            <div class="time">‚è∞ ${app.time.slice(0,5)}</div>
                            <div><strong>–ö–ª–∏–µ–Ω—Ç:</strong> ${app.client_name}</div>
                            <div><strong>–£—Å–ª—É–≥–∞:</strong> ${app.service_name}</div>
                            <div>üìû <a href="tel:${app.client_phone}">${app.client_phone}</a></div>
                            <div>–°—Ç–∞—Ç—É—Å: ${app.status_display}</div>
                        </div>
                    `;
                });
                container.innerHTML = html;

            } catch (error) {
                console.error(error);
                container.innerHTML = '–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ.';
            }
        }

        // –ó–∞—Ä–µ–¥–∏ –≤–µ–¥–Ω–∞–≥–∞ –ø—Ä–∏ –æ—Ç–≤–∞—Ä—è–Ω–µ
        loadSchedule();
    </script>

</body>
</html>